package net.zonixmc.exploits.violation.model;

import com.google.common.collect.Maps;
import lombok.Getter;
import lombok.RequiredArgsConstructor;
import lombok.Setter;

import java.util.Map;

@RequiredArgsConstructor @Getter @Setter
public class Violations {

    private static final short RESET_DELAY = 5000;

    private final String owner;
    private final Map<String, Integer> violations = Maps.newHashMap();
    private long resetAt = System.currentTimeMillis() + RESET_DELAY;
    private boolean punished = false;

    public boolean addViolations(String context, Integer limit) {

        long currentTime = System.currentTimeMillis();

        if (currentTime - resetAt >= 0L) {

            violations.clear();
            resetAt = currentTime + RESET_DELAY;

        }

        Integer currentAttempts = violations.getOrDefault(context, 0);

        violations.put(context, ++currentAttempts);

        if (limit == null) return false;

        return currentAttempts >= limit;

    }

}
